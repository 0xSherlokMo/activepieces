<ap-dialog-title-template i18n>Write Code with AI</ap-dialog-title-template>
<ng-container *ngIf="!receivedCode; then promptTemplate else editTemplate"></ng-container>

<ng-template #promptTemplate>
    <mat-dialog-content>
        <div class="ap-typography-body-1 ap-text-description ap-mb-4" i18n>
            Let AI help you write code for this step. Write your prompt below to get started.
        </div>
        <form class="ap-flex ap-flex-col ap-gap-1" [formGroup]="promptForm" (submit)="prompt()">
            <mat-form-field class="ap-w-full" appearance="outline">
                <textarea cdkFocusInitial formControlName="prompt" matInput cdkTextareaAutosize
                    cdkAutosizeMinRows="5"></textarea>
            </mat-form-field>
            <mat-slide-toggle formControlName="passExistingCode" color="primary">Pass existing code to
                AI</mat-slide-toggle>
        </form>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <div class="ap-flex ap-gap-2.5">
            <ap-button btnColor="basic" mat-dialog-close btnSize="default" i18n>
                Cancel
            </ap-button>
            <ap-button cdkFocusInitial btnSize="default" btnColor="primary" (click)="prompt()"
                [loading]="!!promptOperation$" i18n>
                Prompt
            </ap-button>
        </div>
    </mat-dialog-actions>
</ng-template>

<ng-template #editTemplate>
    <mat-dialog-content>
        <div class="ap-typography-body-1 ap-text-description ap-mb-4" i18n>
            Here is the code our AI wrote for you. Ask for changes or use the code in your action.
        </div>
        <pre class="ap-text-sm ap-px-4 ap-py-2 ap-bg-header ap-mb-4"><code>{{ receivedCode }}</code></pre>
        <form class="ap-flex ap-flex-row ap-gap-1 ap-justify-center" style="align-items: center;" [formGroup]="repromptForm" (submit)="update()">
            <mat-form-field class="ap-w-full" appearance="outline">
                <input cdkFocusInitial formControlName="prompt" matInput type="text" />
            </mat-form-field>
            <ap-button cdkFocusInitial btnStyle="stroked" btnSize="default" btnColor="primary" (click)="update()"
                [loading]="!!promptOperation$" i18n>
                Prompt
            </ap-button>
        </form>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <div class="ap-flex ap-gap-2.5">
            <ap-button btnColor="basic" (click)="reset()" btnSize="default" i18n>
                Start Over
            </ap-button>
            <ap-button btnColor="basic" mat-dialog-close btnSize="default" i18n>
                Cancel
            </ap-button>
            <ap-button cdkFocusInitial btnSize="default" btnColor="primary" (click)="useCode()"
                [loading]="!!promptOperation$" i18n>
                Use Code
            </ap-button>
        </div>
    </mat-dialog-actions>
</ng-template>

<ng-container *ngIf="promptOperation$ | async"></ng-container>