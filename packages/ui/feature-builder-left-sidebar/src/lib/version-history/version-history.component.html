<ap-sidebar-header (closeClicked)="closeSidebar()" [title]="sideBarDisplayName"></ap-sidebar-header>
<ng-container *ngIf="flowVersions$ | async as flowVersions; else loading">
    <ng-container *ngIf="!rollingBack; else loading">
        <div class="ap-flex ap-flex-col ap-gap-4 ap-p-5">
            <ng-container *ngFor="let version of flowVersions.data;let idx=index">
                <div class="ap-flex  ap-items-center ">

                    <div>
                        <div class="ap-text-body">{{version.created |date:'mediumDate'
                            }}, {{version.created |date:'shortTime' }} </div>
                        <div class=" ap-text-description  ap-mb-2">Version #{{flowVersions.data.length - idx}}</div>
                    </div>
                    <div class="ap-flex-grow"></div>


                    <div class="ap-w-[45px] ap-flex ap-items-center ap-justify-center" matTooltip="Published"
                        i18bn-matTooltip *ngIf="(publishedVersion$| async)?.id === version.id">
                        <div class="ap-rounded-full  ap-bg-success-light ap-h-[10px] ap-w-[10px]">

                        </div>
                    </div>

                    <div class="ap-w-[45px] ap-flex ap-items-center ap-justify-center" matTooltip="Draft"
                        i18bn-matTooltip
                        *ngIf="(draftVersionId$| async) === version.id && (publishedVersion$| async)?.id !== version.id">
                        <div class="ap-rounded-full  ap-bg-warn ap-h-[10px] ap-w-[10px]">

                        </div>
                    </div>

                    <button mat-icon-button (click)="$event.stopImmediatePropagation()" [matMenuTriggerFor]="menu">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu" xPosition="before">

                        <button mat-menu-item (click)="displayVersion(version)">
                            <div class="ap-flex ap-gap-3 ap-items-center" i18n>
                                View
                            </div>
                        </button>
                        <button *ngIf="(draftVersionId$| async) !== version.id" mat-menu-item i18n
                            (click)="rollback(version)">
                            Use as draft
                        </button>

                    </mat-menu>

                </div>

            </ng-container>
        </div>
    </ng-container>

</ng-container>
<ng-template #loading>
    <div class="ap-flex ap-items-center ap-justify-center ap-h-[calc(100vh-204px)]">
        <ap-loading-icon></ap-loading-icon>
    </div>
</ng-template>

<ng-container *ngIf="rollbackVersion$ | async"></ng-container>
<ng-container *ngIf="displayVersion$ | async"></ng-container>